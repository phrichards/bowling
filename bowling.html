<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <form>
        <div id="frame1">
            <label>1</label>
            <input type="text" maxlength="1" class="frame" id="f1b1" name="first1" onchange="validateScore(this.value, this.id, 1)">
            <input disabled type="text" maxlength="1" class="frame" id="f1b2" name="first2" onFocus="this.select()" onchange="validateScore(this.value, this.id, 1)">
            <span class="score"></span>
        </div>
        <div id="frame2">
            <label>2</label>
            <input disabled type="text" maxlength="1" class="frame" id="f2b1" name="second1" onchange="validateScore(this.value, this.id, 2)">
            <input disabled type="text" maxlength="1" class="frame" id="f2b2" name="second2" onchange="validateScore(this.value, this.id, 2)">
            <span class="score"></span>
        </div>
        <div id="frame3">
            <label>3</label>
            <input disabled type="text" maxlength="1" class="frame" id="f3b1" name="third1" onchange="validateScore(this.value, this.id, 3)">
            <input disabled type="text" maxlength="1" class="frame" id="f3b2" name="third2" onchange="validateScore(this.value, this.id, 3)">
            <span class="score"></span>
        </div>
        <div id="frame4">
            <label>4</label>
            <input disabled type="text" maxlength="1" class="frame" id="f4b1" name="fourth1" onchange="validateScore(this.value, this.id, 4)">
            <input disabled type="text" maxlength="1" class="frame" id="f4b2" name="fourth2" onchange="validateScore(this.value, this.id, 4)">
            <span class="score"></span>
        </div>
        <div id="frame5">
            <label>5</label>
            <input disabled type="text" maxlength="1" class="frame" id="f5b1" name="fifth1" onchange="validateScore(this.value, this.id, 5)">
            <input disabled type="text" maxlength="1" class="frame" id="f5b2" name="fifth2" onchange="validateScore(this.value, this.id, 5)">
            <span class="score"></span>
        </div>
        <div id="frame6">
            <label>6</label>
            <input disabled type="text" maxlength="1" class="frame" id="f6b1" name="sixth1" onchange="validateScore(this.value, this.id, 6)">
            <input disabled type="text" maxlength="1" class="frame" id="f6b2" name="sixth2" onchange="validateScore(this.value, this.id, 6)">
            <span class="score"></span>
        </div>
        <div id="frame7">
            <label>7</label>
            <input disabled type="text" maxlength="1" class="frame" id="f7b1" name="seventh1" onchange="validateScore(this.value, this.id, 7)">
            <input disabled type="text" maxlength="1" class="frame" id="f7b2" name="seventh2" onchange="validateScore(this.value, this.id, 7)">
            <span class="score"></span>
        </div>
        <div id="frame8">
            <label>8</label>
            <input disabled type="text" maxlength="1" class="frame" id="f8b1" name="eighth1" onchange="validateScore(this.value, this.id, 8)">
            <input disabled type="text" maxlength="1" class="frame" id="f8b2" name="eighth2" onchange="validateScore(this.value, this.id, 8)">
            <span class="score"></span>
        </div>
        <div id="frame9">
            <label>9</label>
            <input disabled type="text" maxlength="1" class="frame" id="f9b1" name="ninth1" onchange="validateScore(this.value, this.id, 9)">
            <input disabled type="text" maxlength="1" class="frame" id="f9b2" name="ninth2" onchange="validateScore(this.value, this.id, 9)">
            <span class="score"></span>
        </div>
        <div id="frame10">
            <label>10</label>
            <input disabled type="text" maxlength="1" class="frame" id="f10b1" name="tenth1" onchange="validateScore(this.value, this.id, 10)">
            <input disabled type="text" maxlength="1" class="frame" id="f10b2" name="tenth2" onchange="validateScore(this.value, this.id, 10)">
            <span class="score"></span>
        </div>

        <p>Score: <span id="finalScore"></span></p>
    </form>
</body>

<script>
    var frames = document.getElementsByClassName('frame');
    frames = Array.from(frames);
    let score = 0;
    let frameScore = 0;
    let totalFrameScore = 0;
    let previousFrameScore = 0;
    var strike = false;
    var spare = false;
    var ball1Score = 0;
    var ball;
    var strikeFrame;
    var spareFrame;

    function validateScore(val, id, frame) {
        if (id.indexOf('b1') > -1) {
            frameScore = 0;
            totalFrameScore = 0;
            var reg = new RegExp(/^[xX0-9]$/g);
            if (val.toLowerCase() == 'x') {
                strike = true; 
            } else {
                frameScore += parseInt(val);
                ball1Score = frameScore;
            }
            ball = 1;
        } else if (id.indexOf('b2') > -1) {
            var reg = new RegExp(/^[/0-9]$/g);
            if (frameScore + parseInt(val) > 10) {
                alert("Please enter a valid score");
                return;
            } else {
                if (val == '/') {
                    spare = true;
                } else {
                    frameScore += parseInt(val);
                    totalFrameScore = frameScore;
                }
            }
            ball = 2;
        }
        
        if (!reg.test(val)) {
            alert("Please enter a valid score");
        } else {
            let thisFrame = document.getElementById(id);
            if (strike) {
                var next = frames[frames.indexOf(thisFrame) + 2];
            } else {
                var next = frames[frames.indexOf(thisFrame) + 1];
            }
            next.disabled = false;
            next.focus();
            if (strike || spare || ball == 2) {
                calculateScore(totalFrameScore, frame);
                strike = false;
                spare = false;
            }
        }
    }

    function calculateScore(totalFrameScore, frame) {
        // this is if this round is a strike
        // how do we know if last round was a strike?
        console.log(`strike? ${strike}`);
        console.log(`spare? ${spare}`);
        console.log(`FrameScore: ${frameScore}`);
        console.log(`TotalFrameScore: ${totalFrameScore}`);
        if (strike) {
            console.log(`frame: ${frame}`);
            strikeFrame = frame;
            console.log(`strikeFrame? ${strikeFrame}`);
        }

        if (spare) {
            console.log(`frame: ${frame}`);
            spareFrame = frame;
            console.log(`spareFrame? ${spareFrame}`);
            console.log(`ball1Score: ${ball1Score}`);
        }
        console.log(`frame: ${frame}`);
        console.log(`strikeFrame: ${strikeFrame}`);
        if (strikeFrame > 0 && frame == strikeFrame + 1) {
            previousFrameScore = totalFrameScore + 10;
            console.log(`previousFrameScore: ${previousFrameScore}`);
            score += previousFrameScore;
            score += totalFrameScore;
            strikeFrame = null;         
        } else if (spareFrame > 0 && frame == spareFrame + 1) {
            console.log('SPAER');
            previousFrameScore = ball1Score + 10;
            console.log(`previousFrameScore: ${previousFrameScore}`);
            score += previousFrameScore;
            score += totalFrameScore;
            spareFrame = null;
        } else {
            score += totalFrameScore;
        }
        document.getElementById('finalScore').innerHTML = score;
    }
    
    // To Do
    // figure out scoring for spares and strikes
    // add reset button
</script>
</html>